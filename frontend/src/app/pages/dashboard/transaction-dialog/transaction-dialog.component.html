<div class="dialog-wrapper">
    <!-- HEADER -->
    <div class="dialog-header">
        <div class="header-content">
            <div class="header-icon-box" [ngClass]="isEdit ? 'edit' : (formTx.type === 1 ? 'income' : 'expense')">
                <mat-icon>{{isEdit ? 'edit_note' : (formTx.type === 1 ? 'add_chart' : 'receipt_long')}}</mat-icon>
            </div>
            <div class="title-group">
                <h2>{{isEdit ? 'İşlemi Düzenle' : (isDuplicate ? 'İşlemi Kopyala' : 'Yeni İşlem Ekle')}}</h2>
                <span>Sistem Veri Giriş Terminali</span>
            </div>
        </div>
        <button mat-icon-button (click)="onCancel()" class="close-btn" matTooltip="Kapat">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- CONTENT -->
    <mat-dialog-content class="dialog-content-area custom-scroll">
        <div class="form-section">

            <!-- Amount Entry Area -->
            <div class="amount-highlight">
                <mat-form-field appearance="fill">
                    <mat-label>İşlem Tutarı</mat-label>
                    <input matInput type="number" [(ngModel)]="formTx.amount" placeholder="0.00" autocomplete="off">
                    <span matSuffix class="currency">TL</span>
                </mat-form-field>
            </div>

            <!-- Taxpayer and Type -->
            <div class="form-row">
                <mat-form-field appearance="fill">
                    <mat-label>Mükellef</mat-label>
                    <mat-select [(ngModel)]="formTx.taxpayer_id">
                        <mat-option *ngFor="let tp of metadata.taxpayers" [value]="tp.id">
                            {{tp.full_name}}
                        </mat-option>
                    </mat-select>
                    <mat-icon matPrefix class="mr-2 text-slate-300 scale-75">person</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>İşlem Tipi</mat-label>
                    <mat-select [(ngModel)]="formTx.type">
                        <mat-option [value]="1" class="!text-emerald-600 font-bold">GELİR</mat-option>
                        <mat-option [value]="-1" class="!text-rose-600 font-bold">GİDER</mat-option>
                    </mat-select>
                    <mat-icon matPrefix class="mr-2 text-slate-300 scale-75">category</mat-icon>
                </mat-form-field>
            </div>

            <!-- Date Fields -->
            <div class="form-row triple">
                <mat-form-field appearance="fill" class="text-center">
                    <mat-label>Gün</mat-label>
                    <input matInput type="number" [(ngModel)]="formTx.day" min="1" max="31">
                </mat-form-field>
                <mat-form-field appearance="fill" class="text-center">
                    <mat-label>Ay</mat-label>
                    <input matInput type="number" [(ngModel)]="formTx.month" min="1" max="12">
                </mat-form-field>
                <mat-form-field appearance="fill" class="text-center">
                    <mat-label>Yıl</mat-label>
                    <input matInput type="number" [(ngModel)]="formTx.year">
                </mat-form-field>
            </div>

            <!-- Source and Payment -->
            <div class="form-row">
                <mat-form-field appearance="fill">
                    <mat-label>Kaynak / Kategori</mat-label>
                    <mat-select [(ngModel)]="formTx.source_id">
                        <mat-option *ngFor="let s of filteredFormSources()" [value]="s.id">
                            {{s.name}}
                        </mat-option>
                    </mat-select>
                    <mat-icon matPrefix class="mr-2 text-slate-300 scale-75">account_balance_wallet</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Ödeme Yöntemi</mat-label>
                    <mat-select [(ngModel)]="formTx.payment_method_id">
                        <mat-option *ngFor="let p of metadata.payment_methods" [value]="p.id">
                            {{p.method_name}}
                        </mat-option>
                    </mat-select>
                    <mat-icon matPrefix class="mr-2 text-slate-300 scale-75">payments</mat-icon>
                </mat-form-field>
            </div>

            <!-- Description -->
            <mat-form-field appearance="fill">
                <mat-label>Açıklama</mat-label>
                <textarea matInput [(ngModel)]="formTx.description" rows="3"
                    placeholder="İşlem detayı giriniz..."></textarea>
                <mat-icon matPrefix class="mr-2 text-slate-300 scale-75">notes</mat-icon>
            </mat-form-field>

            <!-- Taxable Checkbox Box -->
            <div class="taxable-box">
                <mat-checkbox [(ngModel)]="formTx.is_taxable" color="primary"></mat-checkbox>
                <div class="toggle-info">
                    <h4>Beyana Dahil Edilsin</h4>
                    <p>Bu işlem resmi vergi hesaplamalarına otomatik olarak dahil edilecektir.</p>
                </div>
            </div>
        </div>
    </mat-dialog-content>

    <!-- FOOTER -->
    <mat-dialog-actions class="dialog-footer">
        <button mat-button (click)="onCancel()" class="btn-action btn-cancel">
            VAZGEÇ
        </button>
        <button mat-flat-button color="primary" (click)="onSave()" class="btn-action btn-save">
            {{isEdit ? 'DEĞİŞİKLİKLERİ KAYDET' : 'KAYDI TAMAMLA'}}
        </button>
    </mat-dialog-actions>
</div>